<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Austrian Appointment Monitor</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background-color: #f4f4f4; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        label { font-weight: bold; display: block; margin-top: 10px; }
        input, button, textarea { width: 100%; margin-top: 5px; margin-bottom: 10px; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        button { cursor: pointer; font-weight: bold; font-size: 16px; }
        #startBtn { background-color: #28a745; color: white; border: none; }
        #stopBtn { background-color: #dc3545; color: white; border: none; display: none; }
        #log { margin-top: 20px; padding: 10px; background: #1e1e1e; color: #00ff00; height: 200px; overflow-y: scroll; font-family: monospace; font-size: 11px; border-radius: 4px; }
        .status-alert { color: #ff4d4d; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2>üá¶üáπ Appointment Monitor</h2>
    
    <label>Target URL:</label>
    <input type="text" id="targetUrl" value="https://appointment.bmeia.gv.at/?fromSpecificInfo=True">

    <label>Form Data (JSON):</label>
    <textarea id="formData" rows="7">{
        "Language": "en", 
        "Office": "TEHERAN",
        "CalendarId": "48907107",
        "PersonCount": "2",
        "Command": "Next"
        }</textarea>

    <label>Trigger Alarm if this text is MISSING:</label>
    <input type="text" id="expectedString" value="For your selection there are unfortunately no appointments available">

    <button id="startBtn" onclick="startMonitoring()">Start Monitoring üöÄ</button>
    <button id="stopBtn" onclick="stopMonitoring()">Stop üõë</button>

    <div id="log">System ready...</div>

    <audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto" loop></audio>
</div>

<script>
    let intervalId = null;
    let isRunning = false;

    async function sendRequest() {
        const targetUrl = document.getElementById('targetUrl').value;
        const expectedString = document.getElementById('expectedString').value;
        const rawData = document.getElementById('formData').value;
        const logDiv = document.getElementById('log');
        const alarm = document.getElementById('alarmSound');
        const timestamp = new Date().toLocaleTimeString();

        // We use a CORS Proxy to bypass browser restrictions
        const proxyUrl = "https://corsproxy.io/?" + encodeURIComponent(targetUrl);

        try {
            const response = await fetch(proxyUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(JSON.parse(rawData))
            });

            const text = await response.text();
            
            // Logic: IF text is NOT found, play alarm
            if (!text.includes(expectedString)) {
                logDiv.innerHTML = `<div class="status-alert">[${timestamp}] üö® ALERT: Slot might be open! Text not found.</div>` + logDiv.innerHTML;
                if (alarm.paused) alarm.play();
            } else {
                logDiv.innerHTML = `<div>[${timestamp}] Checked: No slots yet.</div>` + logDiv.innerHTML;
            }

        } catch (error) {
            logDiv.innerHTML = `<div style="color: orange;">[${timestamp}] ‚ö†Ô∏è Error: ${error.message}</div>` + logDiv.innerHTML;
        }
    }

    function startMonitoring() {
        isRunning = true;
        document.getElementById('alarmSound').load();
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('stopBtn').style.display = 'inline-block';
        sendRequest();
        intervalId = setInterval(sendRequest, 3000); // Increased to 3 seconds to avoid proxy limits
    }

    function stopMonitoring() {
        isRunning = false;
        clearInterval(intervalId);
        document.getElementById('startBtn').style.display = 'inline-block';
        document.getElementById('stopBtn').style.display = 'none';
        const alarm = document.getElementById('alarmSound');
        alarm.pause();
        alarm.currentTime = 0;
    }
</script>

</body>
</html>
