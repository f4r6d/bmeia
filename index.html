<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Austrian Appointment Monitor</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 20px; background-color: #f4f4f4; line-height: 1.6; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        label { font-weight: bold; display: block; margin-top: 10px; }
        input, button, select, textarea { width: 100%; margin-top: 5px; margin-bottom: 10px; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        button { cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.3s; }
        #startBtn { background-color: #28a745; color: white; border: none; }
        #startBtn:hover { background-color: #218838; }
        #stopBtn { background-color: #dc3545; color: white; border: none; display: none; }
        #log { margin-top: 20px; padding: 10px; background: #1e1e1e; color: #00ff00; height: 200px; overflow-y: scroll; font-family: monospace; font-size: 12px; border-radius: 4px; }
        .status-alert { color: #ff4d4d; font-weight: bold; background: rgba(255,0,0,0.1); padding: 2px 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2>üá¶üáπ Appointment Monitor</h2>
    
    <label>Destination URL:</label>
    <input type="text" id="targetUrl" value="https://appointment.bmeia.gv.at/?fromSpecificInfo=True">
    
    <label>Request Method:</label>
    <select id="method">
        <option value="POST" selected>POST</option>
        <option value="GET">GET</option>
    </select>

    <label>Form Data (JSON):</label>
    <textarea id="formData" rows="7">{
"Language": "en", 
"Office": "TEHERAN",
"CalendarId": "48907107",
"PersonCount": 2,
"Command": "Next"
}</textarea>

    <label>Trigger Alarm if this text is GONE (Not Found):</label>
    <input type="text" id="expectedString" value="For your selection there are unfortunately no appointments available">

    <button id="startBtn" onclick="startMonitoring()">Start Monitoring üöÄ</button>
    <button id="stopBtn" onclick="stopMonitoring()">Stop üõë</button>

    <div id="log">System ready... awaiting start.</div>

    <audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto" loop></audio>
</div>

<script>
    let intervalId = null;
    let isRunning = false;

    async function sendRequest() {
        const url = document.getElementById('targetUrl').value;
        const method = document.getElementById('method').value;
        const expectedString = document.getElementById('expectedString').value;
        const rawData = document.getElementById('formData').value;
        const logDiv = document.getElementById('log');
        const alarm = document.getElementById('alarmSound');
        const timestamp = new Date().toLocaleTimeString();

        try {
            const options = {
                method: method,
                headers: { 'Content-Type': 'application/json' }
            };

            if (method === 'POST') {
                options.body = JSON.stringify(JSON.parse(rawData));
            }

            const response = await fetch(url, options);
            const text = await response.text();
            
            // LOGIC: If the "No appointments" text is NOT found, it means something changed (Potential Slot!)
            if (!text.includes(expectedString)) {
                logDiv.innerHTML = `<div class="status-alert">[${timestamp}] üö® ALERT: Target text missing! Check the website NOW!</div>` + logDiv.innerHTML;
                if (alarm.paused) alarm.play();
            } else {
                logDiv.innerHTML = `<div>[${timestamp}] Still no appointments available.</div>` + logDiv.innerHTML;
            }

        } catch (error) {
            logDiv.innerHTML = `<div style="color: orange;">[${timestamp}] ‚ö†Ô∏è Request failed (Check CORS or Connection): ${error.message}</div>` + logDiv.innerHTML;
        }
    }

    function startMonitoring() {
        if (isRunning) return;
        document.getElementById('alarmSound').load(); // Preload for browser permission
        
        isRunning = true;
        document.getElementById('startBtn').style.display = 'none';
        document.getElementById('stopBtn').style.display = 'inline-block';
        document.getElementById('log').innerHTML = "<div>Started monitoring...</div>";
        
        sendRequest();
        intervalId = setInterval(sendRequest, 1000);
    }

    function stopMonitoring() {
        isRunning = false;
        clearInterval(intervalId);
        document.getElementById('startBtn').style.display = 'inline-block';
        document.getElementById('stopBtn').style.display = 'none';
        
        const alarm = document.getElementById('alarmSound');
        alarm.pause();
        alarm.currentTime = 0;
    }
</script>

</body>
</html>